# ascenso

## Configuration

This describes how to configure Firebase Hosting for a scenario where the app
uses a site name that differs from its Firebase Project ID. By default, the app
will be deployed to `<project ID>.web.app`. However, it's possible to configure
additional sites for Firebase Hosting â€” sometimes a desired name won't be
available as a Firebase (or Google Cloud) Project ID, but it will still be
available as a Firebase Hosting site name.

With a project ID of `myapp-1234` and a site name of `myapp`, the following
configuration will be achieved:

*   `myapp.web.app` serves the actual app.
*   `myapp-1234.web.app` redirects to `https://myapp.web.app/`.

See the [Firebase Hosting docs](https://firebase.google.com/docs/hosting) for
more details.

### .firebaserc

```json
{
  "projects": {
    "default": "myapp-1234"
  },
  "targets": {
    "myapp-1234": {
      "hosting": {
        "prod": [
          "myapp"
        ],
        "project": [
          "myapp-1234"
        ]
      }
    }
  }
}
```

### firebase.json

This file is typically generated by `firebase init`. Only Firebase Hosting's
configuration is described here.

```json
{
  "hosting": [
    {
      "target": "prod",
      "public": "dist",
      "ignore": [
        "firebase.json",
        "**/.*",
        "**/node_modules/**"
      ],
      "rewrites": [
        {
          "source": "**",
          "destination": "/index.html"
        }
      ]
    },
    {
      "target": "project",
      "public": "public/empty",
      "redirects": [
        {
          "source": "**",
          "destination": "https://myapp.web.app/",
          "type": 301
        }
      ]
    }
  ]
}
```

### src/firebase/config.js

Firebase configuration values are available from the
[Firebase Console](https://console.firebase.google.com/):

*   Open the settings page by clicking the gear icon to the right of `Project
    Overview` in the top left corner of the page and selecting `Project
    settings`.
*   In the `General` tab, scroll down to `Your apps`.
*   Under `Firebase SDK snippet`, click `Config`.

Use the following format in the local file:

```js
export default {
  apiKey: "...",
  authDomain: "...",
  databaseURL: "...",
  projectId: "...",
  storageBucket: "",
  messagingSenderId: "...",
  appId: "...",
};
```

## Cloud Firestore schema

Attempting to impose a modicum of order in the brave new NoSQL world:

### `global` collection

Heterogeneous singleton documents:

*   `config` - Document containing global configuration.
    *   `competitionName` - String field containing competition name, e.g. `"My
        Competition 2019"`.

### `areas` collection

Read-only area data:

*   `<area>` - Document containing info about an area. ID should be a
    `hacker_style` version of the `name` field, e.g. `my_area`.
    *   `name` - String field containing area name, e.g. `"My Area"`.
    *   `sort` - Number field containing sort index. Values should start with 1,
        but non-integer values can be introduced when reordering or inserting
        routes.
    *   `routes` - Subcollection containing the area's routes.
        *   `<route>` - Document containing info about a route. ID should be a
            `hacker_style` version of the `name` field, e.g. `my_route`.
            *   `name` - String field containing route name, e.g. `"My Route"`.
            *   `grade` - String field containing route grade, e.g. `"5.10c"` or
                `"5.11c/d"`.
            *   `pointsLead` - Number field containing points awarded for
                leading the route.
            *   `pointsTopRope` - Number field containing points awarded for
                top-roping the route.
            *   `sort` - Number field containing sort index.
